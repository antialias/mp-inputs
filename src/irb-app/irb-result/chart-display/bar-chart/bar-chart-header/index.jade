mixin sort-icon(colAccessor)
  - const isAxis = !isFinite(colAccessor)
  .sort-icon(
    class={
      'sort-axis': isAxis,
      'sort-bar-header': !isAxis,
    }
    on={
      click: () => $helpers.clickedHeader(colAccessor),
    }
  )
    - const icon = isAxis ? $helpers.getAxisSortIcon() : $helpers.getHeaderSortActive(colAccessor);
    svg-icon(attrs=({icon, empty: !icon}))


mixin sort-holder(type, sortByOptions, sortOrderOptions, colAccessor)
  .sort-holder
    mp-drop-menu.sort-controls(
      attrs={open: activeSortPanel === colAccessor}
      on={change: ev => $helpers.menuChange(ev, colAccessor)}
    )
      .chart-controls-component.chart-control
        .title sort
        ul.control-list
          each sortBy in sortByOptions
            each sortOrder in sortOrderOptions
              - const isSelected = $helpers.isSortSelected(colAccessor, sortBy, sortOrder)
              li
                button.button-option(
                  class={selected: isSelected}
                  on={click: () => isSelected ? null : $helpers.selectedHeaderSort(type, colAccessor, sortBy, sortOrder)}
                )
                  span.button-flex-wrapper
                    -const sortByIconName = $helpers.SORT_ICONS[sortBy]
                    .sort-icon
                      svg-icon(attrs=({icon: `sort-${sortByIconName}-${sortOrder}`}))
                    .sort-by-label= sortByIconName
                    .sort-order-label= sortOrder

.chart-header-container
  if headersStyle
    each header, idx in headersStyle
      .bar-chart-header.irb-learn-manipulate-data-disabled(
        class={'active-sort-panel': activeSortPanel == idx}
        style={width: `${header.width}px`}
      )
        - const headerLabel = $helpers.renameHeaderLabel(header.name)
        .text.shrinkable-label(
          on={click: () => $helpers.clickedHeader(idx)}
          attrs={title: headerLabel}
        )= headerLabel
        +sort-icon(idx)
        +sort-holder(`colSort`, [`label`, `value`], [`asc`, `desc`], idx)
    .bar-chart-axis(
      class={'active-sort-panel': activeSortPanel == `axis`}
      style={width: axisWidthStyle}
    )
      .axis-title
        .text.shrinkable-label(
          on={click: () => $helpers.clickedHeader(`axis`)}
          attrs={title: chartLabel}
        )= chartLabel
        +sort-icon(`axis`)
        +sort-holder(`axisSort`, [`value`], [`asc`, `desc`], `axis`)
      .max-value
        .text(on={click: $helpers.clickedMaxValue})= $helpers.getMaxValueLabel()
