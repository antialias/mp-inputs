.chart-legend
  .header Legend
  .search
    focus-input(
      attributes={placeholder: 'search'}
      focusDelay=200
      oninput=$helpers.searchHandler
    )
  .body
    -const legendDataToDisplay = $helpers.legendDataToDisplay()
    if !legendDataToDisplay.length
      .no-result= 'No results match this search'
    each series, seriesIdx in legendDataToDisplay
      -const formattedSeriesName = util.renameProperty(series.seriesName)
      .legend-series
        .info
          .name= formattedSeriesName
          .count #{$helpers.selectedSeriesCount(seriesIdx)}/#{$helpers.totalSeriesCount(seriesIdx)}
        ul.series-names
          if !$helpers.isSearchActive()
            li
              button.select-all(
                class={showing: $helpers.allSeriesSelected(seriesIdx)}
                onclick=() => $helpers.toggleAllSeriesValue(seriesIdx)
              )
                .icon
                .label= `Select all ${formattedSeriesName} segments`
          if !series.seriesValues.length
            .no-result= 'No matches'
          each value in series.seriesValues
            li
              button.series(
                class={showing: $helpers.isSeriesValueShowing(seriesIdx, value)}
                onclick=() => $helpers.toggleShowSeriesValue(seriesIdx, value)
              )
                .icon
                -const label = $helpers.renameSeriesValue(seriesIdx, value)
                if $helpers.isSearchActive()
                  .label.search-result
                    span.slice.matches-search=label.slice(0, report.legend.search.length)
                    span.slice=label.slice(report.legend.search.length)
                else
                  .label= label
