include ../mixins.jade

.builder-screen.sources
  if contextFilter
    mp-items-menu(
      attrs={
        progressive: true,
        'search-filter': contextFilter,
        'sections': JSON.stringify($helpers.getSections()),
      }
      on={
        draw: $helpers.updateRenderedSizeOnNextFrame,
        clickItem: $helpers.clickedItem,
        clickPropertiesPill: $helpers.clickedEventProperties,
        focusItem: $helpers.handleItemFocus,
      }
    )
    mp-event-definition-tooltip(
      attrs={
        'event-definition': JSON.stringify(eventDefinition),
        'lexicon-url': lexiconUrl,
        open: !!eventDefinition,
      }
    )
  else
    +screen-title(`Select Source`, {
      backButton: !!$helpers.screenIdx(),
      theme: `lite`,
    })
    .resource-type-control
      mp-toggle.sources-toggle(
        attrs={
          selected: $helpers.getSelectedResourceType(),
          theme: `lite`,
        }
        on={
          select: $helpers.clickedSource,
        }
      )
        each source in $helpers.getSources()
          mp-toggle-option(attrs={
            value: source.resourceType,
            disabled: learnActive && source.resourceType !== `events`,
          })= source.name
      each source in $helpers.getSources()
        - const resourceType = source.resourceType
        - const upsellType = $helpers.shouldShowSourceUpsell(resourceType) ? `upsell` : `alert`;
        .svg-icon-wrapper.sources(
          class={
            [resourceType]: true,
            [upsellType]: true,
          }
        )
          if $helpers.shouldShowSourceUpsell(resourceType)
            svg-icon(attrs={ icon: 'lighting-bolt' })
          if $helpers.shouldShowSourceAlert(resourceType)
            svg-icon(attrs={ icon: 'alert' })

    = $component.child($helpers.getSelectedResourceType() === `events` ? `builder-screen-events` : `builder-screen-people`, {attrs: {'is-embedded': true}})
